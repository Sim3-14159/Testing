<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HTML Editor</title>
<style>
  body { display: flex; height: 100vh; margin: 0; font-family: sans-serif; }
  textarea { width: 50%; height: 100%; padding: 10px; box-sizing: border-box; font-family: monospace; }
  iframe { width: 50%; height: 100%; border: none; }
</style>
</head>
<body>

<textarea id="editor"><!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="style.css">
</head>
<body>
<h1>Hello world!</h1>
</body>
</html></textarea>

<iframe id="preview"></iframe>

<script>
if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js').then(() => {
        console.log("Service Worker registered!");
    }).catch(console.error);
}

const editor = document.getElementById('editor');
const preview = document.getElementById('preview');

// Virtual filesystem: filename â†’ content
let files = {
    "index.html": editor.value,
    "style.css": "body { background: #eef; color: #333; font-family: sans-serif; }"
};

// Send updated files to service worker
function updateSW() {
    if (navigator.serviceWorker.controller) {
        navigator.serviceWorker.controller.postMessage({
            type: "updateFS",
            files
        });
    }
}

// Initial update
updateSW();

// Update preview iframe
function updatePreview() {
    files["index.html"] = editor.value;
    updateSW();
    preview.src = 'index.html';
}

editor.addEventListener('input', updatePreview);

// Force initial preview
updatePreview();
</script>

</body>
</html>
